<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HydroCalc | Sucção e Recalque</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --suction: #4cc9f0;
            --discharge: #f72585;
            --dark: #2b2d42;
            --light: #f8f9fa;
            --success: #2ec4b6;
            --warning: #ff9f1c;
            --error: #e71d36;
            --info: #3f37c9;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', system-ui, -apple-system, sans-serif;
        }

        body {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 2rem;
        }

        .calculator {
            background: white;
            padding: 2.5rem;
            border-radius: 1.5rem;
            box-shadow: 
                0 20px 50px rgba(0, 0, 0, 0.1),
                0 10px 20px rgba(0, 0, 0, 0.05);
            width: 100%;
            max-width: 900px;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .calculator:hover {
            transform: translateY(-5px);
        }

        .calculator::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, var(--suction), var(--discharge));
        }

        .header {
            display: flex;
            align-items: center;
            margin-bottom: 2rem;
            gap: 1rem;
            position: relative;
        }

        .header i {
            font-size: 2.2rem;
            color: var(--primary);
            background: linear-gradient(135deg, var(--suction), var(--discharge));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        h1 {
            color: var(--dark);
            margin-bottom: 0;
            font-weight: 600;
            font-size: 1.8rem;
            background: linear-gradient(90deg, var(--suction), var(--discharge));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            color: #6c757d;
            font-size: 0.9rem;
            margin-top: 0.3rem;
            font-weight: 400;
        }

        .input-group {
            margin-bottom: 1.5rem;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 0.6rem;
            color: var(--dark);
            font-weight: 500;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        input, select {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e9ecef;
            border-radius: 0.8rem;
            font-size: 1rem;
            transition: all 0.3s ease;
            background-color: #f8f9fa;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            background-color: white;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .input-icon {
            position: absolute;
            right: 1rem;
            top: 2.6rem;
            color: #adb5bd;
        }

        button {
            width: 100%;
            padding: 1.2rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 0.8rem;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(67, 97, 238, 0.3);
            position: relative;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.8rem;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                rgba(255, 255, 255, 0.3),
                rgba(255, 255, 255, 0.1)
            );
            transform: rotate(30deg);
            transition: all 0.3s ease;
        }

        button:hover::after {
            left: 100%;
        }

        .result {
            margin-top: 2.5rem;
            padding: 1.8rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 0.8rem;
            display: none;
            border: 1px solid rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }

        .result.active {
            display: block;
            animation: fadeIn 0.6s cubic-bezier(0.22, 1, 0.36, 1);
        }

        .result::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, var(--suction), var(--discharge));
        }

        .result h2 {
            color: var(--dark);
            margin-bottom: 1.2rem;
            font-weight: 600;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .result-value {
            font-size: 2rem;
            color: var(--success);
            font-weight: 700;
            margin-bottom: 0.5rem;
            letter-spacing: -1px;
        }

        .result-unit {
            color: #6c757d;
            font-size: 1rem;
        }

        .water-mark {
            position: absolute;
            bottom: 1rem;
            right: 1rem;
            color: rgba(0,0,0,0.05);
            font-size: 5rem;
            z-index: 0;
            pointer-events: none;
        }

        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(20px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        @media (max-width: 600px) {
            .calculator {
                padding: 1.8rem;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .water-mark {
                font-size: 3rem;
                bottom: 0.5rem;
                right: 0.5rem;
            }
        }

        /* Seções específicas */
        .section {
            border-radius: 0.8rem;
            padding: 1.5rem;
            margin: 1.5rem 0;
            position: relative;
            overflow: hidden;
        }
        
        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
        }
        
        .suction-section {
            border: 2px solid var(--suction);
        }
        
        .suction-section::before {
            background: var(--suction);
        }
        
        .discharge-section {
            border: 2px solid var(--discharge);
        }
        
        .discharge-section::before {
            background: var(--discharge);
        }
        
        .section-title {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            margin-bottom: 1.5rem;
            color: var(--dark);
        }
        
        .section-title i {
            font-size: 1.5rem;
        }
        
        .suction-section .section-title i {
            color: var(--suction);
        }
        
        .discharge-section .section-title i {
            color: var(--discharge);
        }
        
        .components-list {
            margin-top: 1rem;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .component-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            align-items: end;
        }
        
        .component-select {
            flex: 3;
            min-width: 300px;
        }
        
        .component-qtd {
            flex: 1;
            min-width: 80px;
        }
        
        .btn-remove {
            padding: 0.3rem 0.6rem;
            background: var(--error);
            border: none;
            border-radius: 0.3rem;
            color: white;
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-add {
            padding: 0.8rem 1.2rem;
            background: var(--success);
            border: none;
            border-radius: 0.5rem;
            color: white;
            cursor: pointer;
            white-space: nowrap;
            min-width: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .total-k-display {
            background: var(--primary);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: bold;
            text-align: center;
            margin-top: 1rem;
            display: flex;
            justify-content: space-between;
        }
        
        .suggestion-item {
            margin: 0.8rem 0;
            padding: 0.8rem;
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .material-selector {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
            flex-wrap: wrap;
        }

        .material-btn {
            padding: 0.5rem 0.8rem;
            background: #e9ecef;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            color: #495057;
            border: 1px solid #dee2e6;
        }

        .material-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .material-btn:hover {
            background: #d8dee6;
            transform: translateY(-1px);
        }

        .material-btn:active {
            transform: translateY(0);
        }
        
        .error-message {
            color: var(--error);
            font-size: 0.85rem;
            margin-top: 0.3rem;
            display: none;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 1rem;
            color: var(--info);
        }
        
        .velocity-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-left: 0.5rem;
            background: var(--success);
        }
        
        .velocity-indicator.warning {
            background: var(--warning);
        }
        
        .velocity-indicator.danger {
            background: var(--error);
        }
        
        .reset-btn {
            background: var(--dark) !important;
            margin-top: 1rem;
        }
        
        .result-section {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: white;
            border-radius: 0.5rem;
            border-left: 4px solid var(--primary);
        }

        .result-section h3 {
            margin-bottom: 0.8rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .result-detail {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }
        
        .section-divider {
            height: 1px;
            background: linear-gradient(90deg, var(--suction), var(--discharge));
            margin: 1.5rem 0;
            position: relative;
        }
        
        .section-divider::after {
            content: 'Bomba';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 0 1rem;
            color: var(--dark);
            font-weight: bold;
        }
        
        .tab-container {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .tab {
            padding: 0.8rem 1.5rem;
            background: #e9ecef;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            background: var(--primary);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="calculator">
        <div class="header">
            <i class="fas fa-water"></i>
            <div>
                <h1>HydroCalc Recalque</h1>
                <p class="subtitle">Cálculo completo de sucção e recalque com separação de trechos</p>
            </div>
        </div>

        <div class="section">
            <h3><i class="fas fa-tint"></i> 1. Determinação da Vazão</h3>
            <div class="flow-toggle-section">
    <button type="button" onclick="toggleFlowInput()" class="flow-input-toggle" id="flow-toggle">
        <i class="fas fa-exchange-alt"></i> Alternar para Vazão Direta
    </button>
</div>
          <div class="flow-calculated" id="flow-calculated">
            <div class="input-group">
                <label for="population"><i class="fas fa-users"></i> População Atendida (hab)</label>
                <input type="number" id="population" placeholder="Ex: 15000">
                <div class="error-message" id="population-error">Valor inválido</div>
            </div>

            <div class="input-group">
                <label for="consumption"><i class="fas fa-glass-water"></i> Consumo per capita (L/dia)</label>
                <input type="number" id="consumption" placeholder="Ex: 200" value="200">
                <div class="error-message" id="consumption-error">Valor inválido</div>
            </div>

            <div class="input-group">
                <label for="time"><i class="fas fa-clock"></i> Tempo de Operação (h/dia)</label>
                <input type="number" id="time" placeholder="Ex: 16" value="16">
                <div class="error-message" id="time-error">Valor inválido (1-24)</div>
            </div>
        </div>
        </div>
      <div class="flow-direct" id="flow-direct" style="display: none;">
    <div class="input-group">
        <label for="direct-flow"><i class="fas fa-water"></i> Vazão Direta (m³/h)</label>
        <input type="number" id="direct-flow" placeholder="Ex: 8.33" step="0.01">
        <div class="error-message" id="flow-error">Valor inválido</div>
    </div>
</div>

        <div class="suction-section section">
            <div class="section-title">
                <i class="fas fa-arrow-down"></i>
                <h3>2. Sucção</h3>
            </div>
            
            <div class="input-group">
                <label for="suction-pipe-length"><i class="fas fa-ruler"></i> Comprimento da Tubulação (m)</label>
                <input type="number" id="suction-pipe-length" placeholder="Ex: 10">
                <div class="error-message" id="suction-length-error">Valor inválido</div>
            </div>
            
            <div class="input-group">
                <label for="suction-pipe-diameter"><i class="fas fa-pipe"></i> Diâmetro da Tubulação (mm)</label>
                <input type="number" id="suction-pipe-diameter" placeholder="Ex: 100">
                <div class="error-message" id="suction-diameter-error">Valor inválido</div>
            </div>
            
            <div class="input-group">
                <label for="suction-roughness"><i class="fas fa-hill-rockslide"></i> Rugosidade Absoluta (mm)</label>
                <input type="number" id="suction-roughness" step="0.001" 
                       value="0.0015" 
                       placeholder="Ex: 0.015">
                <div class="material-selector">
                    <button class="material-btn" onclick="setMaterial('pvc', 'suction')">PVC</button>
                    <button class="material-btn" onclick="setMaterial('aco', 'suction')">Aço</button>
                    <button class="material-btn" onclick="setMaterial('concreto', 'suction')">Concreto</button>
                    <button class="material-btn" onclick="setMaterial('cobre', 'suction')">Cobre</button>
                    <button class="material-btn" onclick="setMaterial('ferro', 'suction')">Ferro Fundido</button>
                </div>
            </div>
            
            <div class="input-group">
                <label for="suction-static-height"><i class="fas fa-mountain"></i> Altura Estática de Sucção (m)</label>
                <input type="number" id="suction-static-height" placeholder="Ex: 2.5">
                <div class="error-message" id="suction-height-error">Valor inválido</div>
            </div>
            
            <h4><i class="fas fa-tools"></i> Componentes Hidráulicos - Sucção</h4>
            
            <div class="component-group">
                <div class="component-select">
                    <select id="suction-component-type">
                        <option value="0.9">Cotovelo 90° (K=0.9)</option>
                        <option value="0.4">Cotovelo 45° (K=0.4)</option>
                        <option value="0.2">Cotovelo 22,5° (K=0.2)</option>
                        <option value="10">Válvula de retenção (K=10)</option>
                        <option value="0.2">Válvula de gaveta aberta (K=0.2)</option>
                        <option value="5.6">Válvula borboleta (K=5.6)</option>
                        <option value="8.5">Válvula globo (K=8.5)</option>
                        <option value="1.5">Tê passagem lateral (K=1.5)</option>
                        <option value="0.6">Tê passagem direta (K=0.6)</option>
                        <option value="1.8">Redução cônica (K=1.8)</option>
                        <option value="15">Válvula de pé com crivo (K=15)</option>
                    </select>
                </div>
                <div class="component-qtd">
                    <input type="number" id="suction-component-qtd" min="0" value="1" placeholder="Qtd">
                </div>
                <button type="button" onclick="addComponent('suction')" class="btn-add">
                    <i class="fas fa-plus"></i> Adicionar
                </button>
            </div>
            
            <div class="components-list" id="suction-components-list"></div>
            
            <div class="total-k-display">
                <span>ΣK Total Sucção:</span> 
                <span id="suction-total-k">0.0</span>
            </div>
        </div>
        
        <div class="section-divider"></div>
        
        <div class="discharge-section section">
            <div class="section-title">
                <i class="fas fa-arrow-up"></i>
                <h3>3. Recalque</h3>
            </div>
            
            <div class="input-group">
                <label for="discharge-pipe-length"><i class="fas fa-ruler"></i> Comprimento da Tubulação (m)</label>
                <input type="number" id="discharge-pipe-length" placeholder="Ex: 500">
                <div class="error-message" id="discharge-length-error">Valor inválido</div>
            </div>
            
            <div class="input-group">
                <label for="discharge-pipe-diameter"><i class="fas fa-pipe"></i> Diâmetro da Tubulação (mm)</label>
                <input type="number" id="discharge-pipe-diameter" placeholder="Ex: 150">
                <div class="error-message" id="discharge-diameter-error">Valor inválido</div>
            </div>
            
            <div class="input-group">
                <label for="discharge-roughness"><i class="fas fa-hill-rockslide"></i> Rugosidade Absoluta (mm)</label>
                <input type="number" id="discharge-roughness" step="0.001" 
                       value="0.0015" 
                       placeholder="Ex: 0.015">
                <div class="material-selector">
                    <button class="material-btn" onclick="setMaterial('pvc', 'discharge')">PVC</button>
                    <button class="material-btn" onclick="setMaterial('aco', 'discharge')">Aço</button>
                    <button class="material-btn" onclick="setMaterial('concreto', 'discharge')">Concreto</button>
                    <button class="material-btn" onclick="setMaterial('cobre', 'discharge')">Cobre</button>
                    <button class="material-btn" onclick="setMaterial('ferro', 'discharge')">Ferro Fundido</button>
                </div>
            </div>
            
            <div class="input-group">
                <label for="discharge-static-height"><i class="fas fa-mountain"></i> Altura Estática de Recalque (m)</label>
                <input type="number" id="discharge-static-height" placeholder="Ex: 30">
                <div class="error-message" id="discharge-height-error">Valor inválido</div>
            </div>
            
            <h4><i class="fas fa-tools"></i> Componentes Hidráulicos - Recalque</h4>
            
            <div class="component-group">
                <div class="component-select">
                    <select id="discharge-component-type">
                        <option value="0.9">Cotovelo 90° (K=0.9)</option>
                        <option value="0.4">Cotovelo 45° (K=0.4)</option>
                        <option value="0.2">Cotovelo 22,5° (K=0.2)</option>
                        <option value="10">Válvula de retenção (K=10)</option>
                        <option value="0.2">Válvula de gaveta aberta (K=0.2)</option>
                        <option value="5.6">Válvula borboleta (K=5.6)</option>
                        <option value="8.5">Válvula globo (K=8.5)</option>
                        <option value="1.5">Tê passagem lateral (K=1.5)</option>
                        <option value="0.6">Tê passagem direta (K=0.6)</option>
                        <option value="1.8">Redução cônica (K=1.8)</option>
                        <option value="15">Válvula de pé com crivo (K=8)</option>
                    </select>
                </div>
                <div class="component-qtd">
                    <input type="number" id="discharge-component-qtd" min="0" value="1" placeholder="Qtd">
                </div>
                <button type="button" onclick="addComponent('discharge')" class="btn-add">
                    <i class="fas fa-plus"></i> Adicionar
                </button>
            </div>
            
            <div class="components-list" id="discharge-components-list"></div>
            
            <div class="total-k-display">
                <span>ΣK Total Recalque:</span> 
                <span id="discharge-total-k">0.0</span>
            </div>
        </div>
        
        <div class="section">
            <h3><i class="fas fa-bolt"></i> 4. Parâmetros Gerais</h3>
            
            <div class="input-group">
                <label for="viscosity"><i class="fas fa-flask"></i> Viscosidade Cinemática (m²/s)</label>
                <input type="number" id="viscosity" step="1e-7" 
                       value="0.000001" 
                       placeholder="Ex: 1e-6">
                <div class="result-unit">
                    <i class="fas fa-info-circle"></i> 
                    Água a 20°C = 1e-6 m²/s | Água a 40°C = 0.66e-6 m²/s
                </div>
            </div>
            
            <div class="input-group">
                <label for="efficiency"><i class="fas fa-percentage"></i> Eficiência da Bomba (%)</label>
                <input type="number" id="efficiency" placeholder="Ex: 70" value="70" min="1" max="100">
            </div>
        </div>

        <button onclick="calculateFullSystem()">
            <i class="fas fa-calculator"></i> Calcular Sistema Completo
        </button>
        
        <button onclick="resetForm()" class="reset-btn">
            <i class="fas fa-redo"></i> Limpar Tudo
        </button>
        
        <div class="loading" id="loading">
            <i class="fas fa-spinner fa-spin"></i> Calculando...
        </div>

        <div class="result" id="result">
            <h2><i class="fas fa-chart-line"></i> Resultados do Sistema</h2>
            
            <div class="result-section">
                <h3><i class="fas fa-tint"></i> Vazão de Projeto</h3>
                <div class="result-detail">
                    <span>Vazão:</span>
                    <span class="result-value" id="flow-result">0,00</span> m³/h
                </div>
            </div>
            
            <div class="result-section">
                <h3><i class="fas fa-arrow-down"></i> Sucção</h3>
                <div class="result-detail">
                    <span>Velocidade:</span>
                    <span id="suction-velocity">0,00</span> m/s
                    <span class="velocity-indicator" id="suction-velocity-indicator"></span>
                </div>
                <div class="result-detail">
                    <span>Perda Contínua (hf):</span>
                    <span id="suction-continuous-loss">0,00</span> m
                </div>
                <div class="result-detail">
                    <span>Perda Localizada (hl):</span>
                    <span id="suction-local-loss">0,00</span> m
                </div>
                <div class="result-detail">
                    <span>Perda Total:</span>
                    <span id="suction-total-loss">0,00</span> m
                </div>
            </div>
            
            <div class="result-section">
                <h3><i class="fas fa-arrow-up"></i> Recalque</h3>
                <div class="result-detail">
                    <span>Velocidade:</span>
                    <span id="discharge-velocity">0,00</span> m/s
                    <span class="velocity-indicator" id="discharge-velocity-indicator"></span>
                </div>
                <div class="result-detail">
                    <span>Perda Contínua (hf):</span>
                    <span id="discharge-continuous-loss">0,00</span> m
                </div>
                <div class="result-detail">
                    <span>Perda Localizada (hl):</span>
                    <span id="discharge-local-loss">0,00</span> m
                </div>
                <div class="result-detail">
                    <span>Perda Total:</span>
                    <span id="discharge-total-loss">0,00</span> m
                </div>
            </div>
            
            <div class="result-section">
                <h3><i class="fas fa-mountain"></i> Alturas Manométricas</h3>
                <div class="result-detail">
                    <span>Altura Estática Sucção:</span>
                    <span id="suction-static-head">0,00</span> m
                </div>
                <div class="result-detail">
                    <span>Altura Estática Recalque:</span>
                    <span id="discharge-static-head">0,00</span> m
                </div>
                <div class="result-detail">
                    <span>Perda Total (Sucção + Recalque):</span>
                    <span id="total-loss">0,00</span> m
                </div>
                <div class="result-detail">
                    <span><strong>Altura Manométrica Total:</strong></span>
                    <span class="result-value" id="total-head">0,00</span> m
                </div>
            </div>

            <div class="result-section">
                <h3><i class="fas fa-bolt"></i> Potência</h3>
                <div class="result-detail">
                    <span>Potência da Bomba:</span>
                    <span class="result-value" id="pump-power">0,00</span> kW
                </div>
                <p class="result-unit">* Eficiência considerada: <span id="efficiency-value">70</span>%</p>
            </div>
        </div>

        <div class="suggestions" id="suggestions">
            <h3><i class="fas fa-lightbulb"></i> Sugestões para Projeto</h3>
            <div class="suggestion-item">
                <strong>Vazão Recomendada:</strong>
                <span id="suggested-flow">0</span> m³/h (+10%)
            </div>
            <div class="suggestion-item">
                <strong>Altura Manométrica Recomendada:</strong>
                <span id="suggested-head">0</span> m (+15%)
            </div>
            <div class="suggestion-item">
                <strong>Potência Comercial Próxima:</strong>
                <span id="suggested-power">0</span> kW
            </div>
            <div class="suggestion-item" id="suction-velocity-suggestion">
                <strong>Velocidade Sucção:</strong>
                <span id="suction-velocity-status">Dentro da faixa recomendada</span>
            </div>
            <div class="suggestion-item" id="discharge-velocity-suggestion">
                <strong>Velocidade Recalque:</strong>
                <span id="discharge-velocity-status">Dentro da faixa recomendada</span>
            </div>
        </div>
        
        <div class="water-mark">
            <i class="fas fa-water"></i>
        </div>
    </div>

<script>
    // Material roughness values
    const materials = {
        pvc: 0.0015,
        aco: 0.15,
        concreto: 0.3,
        cobre: 0.001,
        ferro: 0.25
    };
    
    let componentsSuction = [];
    let totalKSucction = 0;
    
    let componentsDischarge = [];
    let totalKDischarge = 0;
    let flowInputMode = 'calculated'; // Padrão: cálculo automático

    function setMaterial(type, section) {
        document.getElementById(section + '-roughness').value = materials[type];
        
        // Highlight selected button
        const buttons = document.querySelectorAll('#' + section + '-roughness ~ .material-selector .material-btn');
        buttons.forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');
    }

    function toggleFlowInput() {
        const button = document.getElementById('flow-toggle');
        const calculated = document.getElementById('flow-calculated');
        const direct = document.getElementById('flow-direct');
        
        if (flowInputMode === 'calculated') {
            flowInputMode = 'direct';
            calculated.style.display = 'none';
            direct.style.display = 'block';
            button.innerHTML = '<i class="fas fa-exchange-alt"></i> Alternar para Cálculo Automático';
        } else {
            flowInputMode = 'calculated';
            calculated.style.display = 'block';
            direct.style.display = 'none';
            button.innerHTML = '<i class="fas fa-exchange-alt"></i> Alternar para Vazão Direta';
        }
    }

    function addComponent(section) {
        const type = document.getElementById(section + '-component-type');
        const qtd = parseInt(document.getElementById(section + '-component-qtd').value) || 0;
        const kValue = parseFloat(type.value);
        const componentName = type.options[type.selectedIndex].text.split(' (')[0];
        
        if(qtd > 0) {
            if (section === 'suction') {
                componentsSuction.push({name: componentName, qtd: qtd, k: kValue});
                totalKSucction += kValue * qtd;
                updateComponentsList(section);
                document.getElementById('suction-component-qtd').value = 1;
                document.getElementById('suction-total-k').textContent = totalKSucction.toFixed(1);
            } else {
                componentsDischarge.push({name: componentName, qtd: qtd, k: kValue});
                totalKDischarge += kValue * qtd;
                updateComponentsList(section);
                document.getElementById('discharge-component-qtd').value = 1;
                document.getElementById('discharge-total-k').textContent = totalKDischarge.toFixed(1);
            }
        }
    }

    function updateComponentsList(section) {
        const list = document.getElementById(section + '-components-list');
        const components = section === 'suction' ? componentsSuction : componentsDischarge;
        
        list.innerHTML = components.map((c, index) => `
            <div class="suggestion-item">
                <div>
                    <strong>${c.qtd}x ${c.name}</strong>
                    <div style="font-size:0.8rem;color:#6c757d;">K = ${c.k}</div>
                </div>
                <button onclick="removeComponent('${section}', ${index})" class="btn-remove">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        `).join('');
    }

    function removeComponent(section, index) {
        if (section === 'suction') {
            totalKSucction -= componentsSuction[index].k * componentsSuction[index].qtd;
            componentsSuction.splice(index, 1);
            updateComponentsList(section);
            document.getElementById('suction-total-k').textContent = totalKSucction.toFixed(1);
        } else {
            totalKDischarge -= componentsDischarge[index].k * componentsDischarge[index].qtd;
            componentsDischarge.splice(index, 1);
            updateComponentsList(section);
            document.getElementById('discharge-total-k').textContent = totalKDischarge.toFixed(1);
        }
    }
    
    function resetForm() {
        // Clear input fields
        document.getElementById('population').value = '';
        document.getElementById('consumption').value = '200';
        document.getElementById('time').value = '16';
        document.getElementById('direct-flow').value = '';
        
        // Suction fields
        document.getElementById('suction-pipe-length').value = '';
        document.getElementById('suction-pipe-diameter').value = '';
        document.getElementById('suction-roughness').value = '0.0015';
        document.getElementById('suction-static-height').value = '';
        
        // Discharge fields
        document.getElementById('discharge-pipe-length').value = '';
        document.getElementById('discharge-pipe-diameter').value = '';
        document.getElementById('discharge-roughness').value = '0.0015';
        document.getElementById('discharge-static-height').value = '';
        
        // General fields
        document.getElementById('viscosity').value = '0.000001';
        document.getElementById('efficiency').value = '70';
        
        // Clear components
        componentsSuction = [];
        totalKSucction = 0;
        updateComponentsList('suction');
        document.getElementById('suction-total-k').textContent = '0.0';
        
        componentsDischarge = [];
        totalKDischarge = 0;
        updateComponentsList('discharge');
        document.getElementById('discharge-total-k').textContent = '0.0';
        
        // Reset flow input mode
        flowInputMode = 'calculated';
        document.getElementById('flow-calculated').style.display = 'block';
        document.getElementById('flow-direct').style.display = 'none';
        document.getElementById('flow-toggle').innerHTML = '<i class="fas fa-exchange-alt"></i> Alternar para Vazão Direta';
        
        // Hide results
        document.getElementById('result').classList.remove('active');
        document.getElementById('suggestions').classList.remove('active');
        
        // Reset material buttons
        document.querySelectorAll('.material-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        // Hide errors
        document.querySelectorAll('.error-message').forEach(el => {
            el.style.display = 'none';
        });
    }
    
    function validateInputs() {
        let isValid = true;
        
        // Hide all errors first
        document.querySelectorAll('.error-message').forEach(el => {
            el.style.display = 'none';
        });
        
        // Validate based on flow input mode
        if (flowInputMode === 'direct') {
            const flow = parseFloat(document.getElementById('direct-flow').value);
            if (!flow || flow <= 0) {
                document.getElementById('flow-error').style.display = 'block';
                isValid = false;
            }
        } else {
            const population = parseFloat(document.getElementById('population').value);
            const consumption = parseFloat(document.getElementById('consumption').value);
            const time = parseFloat(document.getElementById('time').value);
            
            if (!population || population <= 0) {
                document.getElementById('population-error').style.display = 'block';
                isValid = false;
            }
            
            if (!consumption || consumption <= 0) {
                document.getElementById('consumption-error').style.display = 'block';
                isValid = false;
            }
            
            if (!time || time <= 0 || time > 24) {
                document.getElementById('time-error').style.display = 'block';
                isValid = false;
            }
        }
        
        // Validate suction parameters
        const suctionLength = parseFloat(document.getElementById('suction-pipe-length').value);
        const suctionDiameter = parseFloat(document.getElementById('suction-pipe-diameter').value);
        const suctionHeight = parseFloat(document.getElementById('suction-static-height').value);
        
        if (!suctionLength || suctionLength <= 0) {
            document.getElementById('suction-length-error').style.display = 'block';
            isValid = false;
        }
        
        if (!suctionDiameter || suctionDiameter <= 0) {
            document.getElementById('suction-diameter-error').style.display = 'block';
            isValid = false;
        }
        
        if (!suctionHeight || suctionHeight <= 0) {
            document.getElementById('suction-height-error').style.display = 'block';
            isValid = false;
        }
        
        // Validate discharge parameters
        const dischargeLength = parseFloat(document.getElementById('discharge-pipe-length').value);
        const dischargeDiameter = parseFloat(document.getElementById('discharge-pipe-diameter').value);
        const dischargeHeight = parseFloat(document.getElementById('discharge-static-height').value);
        
        if (!dischargeLength || dischargeLength <= 0) {
            document.getElementById('discharge-length-error').style.display = 'block';
            isValid = false;
        }
        
        if (!dischargeDiameter || dischargeDiameter <= 0) {
            document.getElementById('discharge-diameter-error').style.display = 'block';
            isValid = false;
        }
        
        if (!dischargeHeight || dischargeHeight <= 0) {
            document.getElementById('discharge-height-error').style.display = 'block';
            isValid = false;
        }
        
        return isValid;
    }

    function calculateFullSystem() {
        // Validate inputs
        if (!validateInputs()) return;
        
        // Show loading indicator
        document.getElementById('loading').style.display = 'block';
        
        // Use setTimeout to allow UI to update before heavy calculations
        setTimeout(() => {
            try {
                let Q_m3h, Q_lps;

                // ETAPA 1: Determinar a Vazão
                if (flowInputMode === 'direct') {
                    Q_m3h = parseFloat(document.getElementById('direct-flow').value);
                    Q_lps = Q_m3h / 3.6; // Converte m³/h para L/s
                } else {
                    const population = parseFloat(document.getElementById('population').value);
                    const consumption = parseFloat(document.getElementById('consumption').value);
                    const time = parseFloat(document.getElementById('time').value);

                    const dailyDemand = population * consumption; // L/dia
                    Q_lps = dailyDemand / (time * 3600); // L/s
                    Q_m3h = Q_lps * 3.6; // m³/h
                }

                // ETAPA 2: Cálculo da Sucção
                const L_suc = parseFloat(document.getElementById('suction-pipe-length').value);
                const D_suc = parseFloat(document.getElementById('suction-pipe-diameter').value) / 1000; // mm para m
                const ε_suc = parseFloat(document.getElementById('suction-roughness').value) / 1000; // mm para m
                const H_suc = parseFloat(document.getElementById('suction-static-height').value);
                const ν = parseFloat(document.getElementById('viscosity').value) || 1e-6;
                const g = 9.81;

                // Cálculos hidráulicos para sucção
                const A_suc = Math.PI * Math.pow(D_suc/2, 2); // Área da seção transversal
                const V_suc = (Q_lps / 1000) / A_suc; // Velocidade (convertendo L/s para m³/s)
                const Re_suc = (V_suc * D_suc) / ν; // Número de Reynolds

                // Cálculo do fator de atrito (Swamee-Jain)
                const term1_suc = Math.pow(ε_suc/D_suc / 3.7, 1.11);
                const term2_suc = 6.9 / Re_suc;
                const f_suc = Math.pow(-1.8 * Math.log10(term1_suc + term2_suc), -2);

                // Perdas de carga na sucção
                const hf_suc = f_suc * (L_suc/D_suc) * (Math.pow(V_suc, 2)/(2*g)); // Perda contínua
                const h_local_suc = totalKSucction * (Math.pow(V_suc, 2)/(2*g)); // Perda localizada
                const h_total_suc = hf_suc + h_local_suc; // Perda total na sucção

                // ETAPA 3: Cálculo do Recalque
                const L_dis = parseFloat(document.getElementById('discharge-pipe-length').value);
                const D_dis = parseFloat(document.getElementById('discharge-pipe-diameter').value) / 1000; // mm para m
                const ε_dis = parseFloat(document.getElementById('discharge-roughness').value) / 1000; // mm para m
                const H_dis = parseFloat(document.getElementById('discharge-static-height').value);

                // Cálculos hidráulicos para recalque
                const A_dis = Math.PI * Math.pow(D_dis/2, 2); // Área da seção transversal
                const V_dis = (Q_lps / 1000) / A_dis; // Velocidade (convertendo L/s para m³/s)
                const Re_dis = (V_dis * D_dis) / ν; // Número de Reynolds

                // Cálculo do fator de atrito (Swamee-Jain)
                const term1_dis = Math.pow(ε_dis/D_dis / 3.7, 1.11);
                const term2_dis = 6.9 / Re_dis;
                const f_dis = Math.pow(-1.8 * Math.log10(term1_dis + term2_dis), -2);

                // Perdas de carga no recalque
                const hf_dis = f_dis * (L_dis/D_dis) * (Math.pow(V_dis, 2)/(2*g)); // Perda contínua
                const h_local_dis = totalKDischarge * (Math.pow(V_dis, 2)/(2*g)); // Perda localizada
                const h_total_dis = hf_dis + h_local_dis; // Perda total no recalque

                // Cálculo da altura manométrica total e potência
                const h_total = h_total_suc + h_total_dis; // Perda total
                const H_total = H_suc + H_dis + h_total; // Altura manométrica total
                const efficiency = parseFloat(document.getElementById('efficiency').value) || 70;
                const P = ((Q_lps / 1000) * 1000 * 9.81 * H_total) / ((efficiency/100) * 1000); // kW

                // Exibir resultados
                document.getElementById('flow-result').textContent = formatNumber(Q_m3h);
                
                // Sucção
                document.getElementById('suction-velocity').textContent = formatNumber(V_suc);
                document.getElementById('suction-continuous-loss').textContent = formatNumber(hf_suc);
                document.getElementById('suction-local-loss').textContent = formatNumber(h_local_suc);
                document.getElementById('suction-total-loss').textContent = formatNumber(h_total_suc);
                document.getElementById('suction-static-head').textContent = formatNumber(H_suc);
                
                // Recalque
                document.getElementById('discharge-velocity').textContent = formatNumber(V_dis);
                document.getElementById('discharge-continuous-loss').textContent = formatNumber(hf_dis);
                document.getElementById('discharge-local-loss').textContent = formatNumber(h_local_dis);
                document.getElementById('discharge-total-loss').textContent = formatNumber(h_total_dis);
                document.getElementById('discharge-static-head').textContent = formatNumber(H_dis);
                
                // Totais
                document.getElementById('total-loss').textContent = formatNumber(h_total);
                document.getElementById('total-head').textContent = formatNumber(H_total);
                document.getElementById('pump-power').textContent = formatNumber(P);
                document.getElementById('efficiency-value').textContent = efficiency;
                document.getElementById('result').classList.add('active');

                // Sugestões e verificações
                calculateSafetyMargins(Q_m3h, H_total, P);
                
                // Update velocity indicators
                updateVelocityIndicator(V_suc, 'suction');
                updateVelocityIndicator(V_dis, 'discharge');
                
            } catch (error) {
                showError('Ocorreu um erro no cálculo: ' + error.message);
            } finally {
                // Hide loading indicator
                document.getElementById('loading').style.display = 'none';
            }
        }, 100);
    }
    
    function updateVelocityIndicator(velocity, section) {
        const indicator = document.getElementById(section + '-velocity-indicator');
        const suggestion = document.getElementById(section + '-velocity-suggestion');
        const status = document.getElementById(section + '-velocity-status');
        
        indicator.className = 'velocity-indicator';
        
        // Valores recomendados diferentes para sucção e recalque
        const minRecommended = section === 'suction' ? 0.6 : 0.8;
        const maxRecommended = section === 'suction' ? 1.5 : 2.5;
        
        if (velocity < minRecommended) {
            indicator.classList.add('danger');
            status.innerHTML = '<span style="color:var(--error)">Muito baixa (risco de sedimentação)</span>';
        } else if (velocity < minRecommended + 0.2) {
            indicator.classList.add('warning');
            status.innerHTML = '<span style="color:var(--warning)">Baixa (pode causar sedimentação)</span>';
        } else if (velocity > maxRecommended) {
            indicator.classList.add('danger');
            status.innerHTML = '<span style="color:var(--error)">Muito alta (risco de erosão e ruído)</span>';
        } else if (velocity > maxRecommended - 0.3) {
            indicator.classList.add('warning');
            status.innerHTML = '<span style="color:var(--warning)">Alta (pode causar ruído)</span>';
        } else {
            indicator.classList.add('success');
            status.innerHTML = '<span style="color:var(--success)">Dentro da faixa recomendada</span>';
        }
        
        suggestion.style.display = 'flex';
    }

    function calculateSafetyMargins(flow, head, power) {
        const suggestedFlow = flow * 1.10;
        const suggestedHead = head * 1.15;

        document.getElementById('suggested-flow').textContent = formatNumber(suggestedFlow);
        document.getElementById('suggested-head').textContent = formatNumber(suggestedHead);

        // Potências comerciais
        const commercialPowers = [1.5, 2.2, 3.7, 5.5, 7.5, 11, 15, 18.5, 22, 30, 37, 45, 55, 75, 90, 110, 132, 160, 200, 250, 315, 400, 500];
        const needed = power * 1.2;
        const found = commercialPowers.find(p => p >= needed) || '>500';
        
        document.getElementById('suggested-power').textContent = found;
        document.getElementById('suggestions').classList.add('active');
    }

    function formatNumber(num) {
        return new Intl.NumberFormat('pt-BR', { maximumFractionDigits: 2 }).format(num);
    }

    function showError(message) {
        const result = document.getElementById('result');
        const pumpPower = document.getElementById('pump-power');
        pumpPower.textContent = message;
        pumpPower.style.color = 'var(--error)';
        result.classList.add('active');
        setTimeout(() => pumpPower.style.color = 'var(--success)', 3000);
    }
    
    // Initialize material buttons
    document.addEventListener('DOMContentLoaded', function() {
        setMaterial('pvc', 'suction');
        setMaterial('pvc', 'discharge');
    });
</script>
</body>
</html>
